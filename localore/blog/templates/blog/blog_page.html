{% extends "base.html" %}

{% load staticfiles wagtailcore_tags wagtailimages_tags blog_tags %}

{% block body_class %}template-connection{% endblock %}

{% block content %}

<div id="title" class="title title-about">
	<div>
		{% get_blog_index_page as blog_index %}
		<h6><a href="{% pageurl blog_index %}">{{ blog_index }}</a></h6>
		<h1>{{ page.title }}</h1>
		<h3>{{ page.subtitle }}</h3>
		{% with prev=page.get_prev_siblings.live.first next=page.get_next_siblings.live.first %}
			{% if prev %}
				<a href="{% pageurl prev %}" title="{{ prev }}" class="title-nav title-prev"></a>
			{% endif %}
			{% if next %}
				<a href="{% pageurl next %}" title="{{ next }}" class="title-nav title-next"></a>
			{% endif %}
		{% endwith %}
	</div>
</div>

<div class="hero-section">
	{% if page.video_mp4 and page.video_webm and page.video_ogv and page.video_poster_image %}
		<div id="preview" class="full-bg-video"
				 data-vide-bg="mp4: {{ page.video_mp4.file.url }}, webm: {{ page.video_webm.file.url }}, ogv: {{ page.video_ogv.file.url }}, poster: {{ page.video_poster_image.file.url }}"
				 data-vide-options="posterType: jpg">
		</div>
	{% else %}
		<div id="preview" class="full-bg-image" style="background-image:url({{ page.video_poster_image.file.url }})"></div>
	{% endif %}
	<div id="main-video" class="full-bg-video">
		<div id="youtube-embed"></div>
	</div>
	{% if page.video_youtube_id %}
		<div class="play-icon"></div>
	{% endif %}
</div>

{% if page.intro %}
<div class="text-description">
	<div class="container">
		{{ page.intro|richtext }}
	</div>
</div>
{% endif %}

<div class="container">

	{# for customizing StreamField rendering, see http://docs.wagtail.io/en/v1.4.2/topics/streamfield.html#template-rendering #}
	{{ page.body }}

	{% if page.associated_productions.all %}
	<div class="connection-prods">
		<h6>Productions Mentioned</h6>
		{% for item in page.associated_productions.all %}
			<a href="{{ item.production_page.url }}" class="link-large">{{ item.production_page }}</a>
		{% if not forloop.last %}, {% endif %}
		{% endfor %}
	</div>
	{% endif %}
</div>

{% if page.related_posts.all %}
<div class="text-description connection-more">
	<div class="container">
		<h6>More connections</h6>
		{% for item in page.related_posts.all %}
			<a href="{{ item.related_blog_page.url }}" class="link-large">{{ item.related_blog_page }}</a>
		{% if not forloop.last %}, {% endif %}
		{% endfor %}
	</div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
{% if page.video_youtube_id %}
	<script type="text/javascript">
		// Load the IFrame Player API code asynchronously.
		var tag = document.createElement('script');
		tag.src = "https://www.youtube.com/player_api";
		var firstScriptTag = document.getElementsByTagName('script')[0];
		firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

		window.YOUTUBE_ID = '{{ page.video_youtube_id }}';
	</script>

	<script type="text/javascript" src="{% static 'js/videos.js' %}"></script>
{% endif %}
{% endblock %}
