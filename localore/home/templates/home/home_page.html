{% extends "base.html" %}

{% load staticfiles wagtailcore_tags productions_tags blog_tags %}

{% block body_class %}template-{{ page.get_verbose_name|slugify }}{% endblock %}

{% block content %}
<div id="title" class="title title-home">
  <div>
    <h1>Oceans</h1>
    <h3>Across America</h3>
  </div>
</div>
<div class="container-full">

	<section class="hero-section">
		<div id="bgVideo" class="full-bg-video"
			{% if page.video_mp4 and page.video_webm and page.video_ogv and page.video_poster_image %}
				data-vide-bg="mp4: {{ page.video_mp4.file.url }}, webm: {{ page.video_webm.file.url }}, ogv: {{ page.video_ogv.file.url }}, poster: {{ page.video_poster_image.file.url }}"
			{% else %}
				data-vide-bg="mp4: {% static 'videos/ocean.mp4' %}, webm: {% static 'videos/ocean.webm' %}, ogv: {% static 'videos/ocean.ogv' %}, poster: {% static 'videos/ocean.jpg' %}"
			{% endif %}
			data-vide-options="posterType: jpg">
		</div>
		<div class="play-icon" data-toggle="modal" data-target="#homeVideo"></div>
	</section>

	<section class="live-feed" id="livefeed">
		<div class="container">
			<h4>Live Feed</h4>
			{{ page.live_feed_intro|richtext }}
		</div>
	</section>


	{% with juicer_feed_id=settings.localore_admin.JuicerSettings.juicer_feed_id %}
	{% if juicer_feed_id %}
	<ul class="juicer-feed" data-feed-id="{{ juicer_feed_id }}" data-style="image-grid"></ul>
	{% endif %}
	{% endwith %}

</div>

<div class="modal fade" id="homeVideo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<a class="modal-close" data-dismiss="modal" aria-label="Close">
		<span aria-hidden="true">Ã—</span>
	</a>
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-body embed-responsive embed-responsive-16by9">
				<!-- <iframe src="https://www.youtube.com/embed/0aQ9S2ywoXQ?modestbranding=1&rel=0&showinfo=0&color=white" frameborder="0"></iframe> -->
				<div id="modal-player" class=""></div>
			</div>
		</div>
	</div>
</div>

{% endblock %}

{% block extra_css %}
	<link href="//assets.juicer.io/embed.css" media="all" rel="stylesheet" type="text/css">
{% endblock %}

{% block extra_js %}
	{# NOTE: need to specify the juicer embed WITHOUT JQUERY #}
	<script src="//assets.juicer.io/embed-no-jquery.js" type="text/javascript"></script>

	<script>
	  // Load the IFrame Player API code asynchronously.
	  var tag = document.createElement('script');
	  tag.src = "https://www.youtube.com/player_api";
	  var firstScriptTag = document.getElementsByTagName('script')[0];
	  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

		$(function() {

			var $play = $('.play-icon');
			var $homeVideo = $('#homeVideo');
			var vide = $('#bgVideo').data('vide').getVideoObject();
			var player;

			window.onYouTubePlayerAPIReady = function() {
				player = new YT.Player('modal-player', {
					videoId: 'j6IIjLK-8fU',
					playerVars: {
						modestbranding: '1',
						rel: '0',
						showinfo: '0',
						color: 'white'
					},
					events: {
						'onStateChange': onPlayerStateChange
					}
				});
				$play.addClass('show');
			}

			// when video ends
			window.onPlayerStateChange = function(event) {
				if(event.data === 0) {
					$homeVideo.modal('hide');
				}
			}

			$homeVideo.on('show.bs.modal', function (e) {
	    	player.playVideo();
				vide.pause();
			});

			$homeVideo.on('hide.bs.modal', function (e) {
				player.pauseVideo();
				vide.play();
			});


		});
	</script>

{% endblock %}
